(section 'filter'
  (version 0)
  (define 'code'
    (loop (varuint32 6) (eval 'code.function'))
  )
  (define 'code.address'
    (varuint32 6)
    (varuint32 6)
  )
  (define 'code.br_table'
    (uint8)
    (loop (varuint32 6) (uint32 6))
    (uint32 6)
  )
  (define 'code.br_target'
    (uint8)
    (varuint32 6)
  )
  (define 'code.call_args'
    (varuint32 6)
    (varuint32 6)
  )
  (define 'code.function'
    (block
      (loop (varuint32 6) (eval 'code.local'))
      (loop.unbounded
        (eval 'code.opcode')
        (eval 'code.inst')
      )
    )
  )
  (define 'code.local'
    (varuint32 6)
    (uint8 3)
  )
  (define 'code.inst'
    (switch (read)
      (void)
      (case (u8.const 6) (eval 'code.br_target'))
      (case (u8.const 7) (eval 'code.br_target'))
      (case (u8.const 8) (eval 'code.br_table'))
      (case (u8.const 9) (uint8))
      (case (u8.const 16) (varint32 6))
      (case (u8.const 17) (varint64 6))
      (case (u8.const 18) (uint64))
      (case (u8.const 19) (uint32))
      (case (u8.const 20) (varuint32 6))
      (case (u8.const 21) (varuint32 6))
      (case (u8.const 22) (eval 'code.call_args'))
      (case (u8.const 23) (eval 'code.call_args'))
      (case (u8.const 24) (eval 'code.call_args'))
      (case (u8.const 32) (eval 'code.address'))
      (case (u8.const 33) (eval 'code.address'))
      (case (u8.const 34) (eval 'code.address'))
      (case (u8.const 35) (eval 'code.address'))
      (case (u8.const 36) (eval 'code.address'))
      (case (u8.const 37) (eval 'code.address'))
      (case (u8.const 38) (eval 'code.address'))
      (case (u8.const 39) (eval 'code.address'))
      (case (u8.const 40) (eval 'code.address'))
      (case (u8.const 41) (eval 'code.address'))
      (case (u8.const 42) (eval 'code.address'))
      (case (u8.const 43) (eval 'code.address'))
      (case (u8.const 44) (eval 'code.address'))
      (case (u8.const 45) (eval 'code.address'))
      (case (u8.const 46) (eval 'code.address'))
      (case (u8.const 47) (eval 'code.address'))
      (case (u8.const 48) (eval 'code.address'))
      (case (u8.const 49) (eval 'code.address'))
      (case (u8.const 50) (eval 'code.address'))
      (case (u8.const 51) (eval 'code.address'))
      (case (u8.const 52) (eval 'code.address'))
      (case (u8.const 53) (eval 'code.address'))
      (case (u8.const 54) (eval 'code.address'))
      (case (u32.const 4294967295) (block.end))
    )
  )
  (define 'code.opcode' (uint8))
  (define 'data'
    (loop (varuint32 6) (eval 'data.segment'))
  )
  (define 'data.segment'
    (varuint32 6)
    (loop (varuint32 6) (uint8))
  )
  (define 'export'
    (loop (varuint32 6) (eval 'export.entry'))
  )
  (define 'export.entry'
    (varuint32 6)
    (eval 'export.symbol')
  )
  (define 'export.symbol'
    (loop (varuint32 6) (uint8))
  )
  (define 'function'
    (loop (varuint32 6) (varuint32 6))
  )
  (define 'import'
    (loop (varuint32 6) (eval 'import.entry'))
  )
  (define 'import.entry'
    (varuint32 6)
    (eval 'import.symbol')
    (eval 'import.symbol')
  )
  (define 'import.symbol'
    (loop (varuint32 6) (uint8))
  )
  (define 'memory'
    (varuint32 6)
    (varuint32 6)
    (uint8)
  )
  (define 'name'
    (loop (varuint32 6) (eval 'name.function'))
  )
  (define 'name.function'
    (eval 'name.symbol')
    (loop (varuint32 6) (eval 'name.symbol'))
  )
  (define 'name.symbol'
    (loop (varuint32 6) (uint8))
  )
  (define 'start' (varuint32 6))
  (define 'table'
    (loop (varuint32 6) (varuint32 6))
  )
  (define 'type'
    (loop (varuint32 6)
      (uint8)
      (loop (varuint32 6) (uint8))
      (loop (varuint32 6) (uint8))
    )
  )
)
